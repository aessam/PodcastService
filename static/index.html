<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Summary</title>
    
    <!-- React and dependencies -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }
        .btn-primary {
            background-color: #4F7DF3;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #3b6ce0;
        }
        .history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .tab-active {
            border-bottom: 2px solid #000;
            font-weight: 500;
        }
        .subscription-section {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .podcast-result {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .podcast-info {
            margin-left: 15px;
        }
        .episode {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .search-box {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }
        .search-box .input-field {
            margin-bottom: 0;
        }
        .search-box .btn-primary {
            min-width: 120px;
        }
        .search-results {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 32px;
        }
        .subscription-container {
            height: calc(100vh - 200px);
            overflow-y: auto;
            padding: 24px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        function Dashboard() {
            const [url, setUrl] = React.useState('');
            const [activeTab, setActiveTab] = React.useState('summary');
            const [activeView, setActiveView] = React.useState('process');
            const [selectedHistoryItem, setSelectedHistoryItem] = React.useState(null);
            const [history, setHistory] = React.useState([]);
            const [searchQuery, setSearchQuery] = React.useState('');
            const [searchResults, setSearchResults] = React.useState([]);
            const [youtubeUrl, setYoutubeUrl] = React.useState('');
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);
            const [isGeneratingAudio, setIsGeneratingAudio] = React.useState(false);
            const [audioFiles, setAudioFiles] = React.useState([]);
            const audioRef = React.useRef(null);
            const [currentAudioIndex, setCurrentAudioIndex] = React.useState(0);
            const [refreshingMetadata, setRefreshingMetadata] = React.useState({});
            const [searchLoading, setSearchLoading] = React.useState(false);
            const [searchError, setSearchError] = React.useState(null);
            const [subscriptions, setSubscriptions] = React.useState([]);
            const [episodes, setEpisodes] = React.useState({ podcast: {} });
            const [latestEpisodes, setLatestEpisodes] = React.useState([]);

            const loadSubscriptions = async () => {
                try {
                    const response = await fetch('/api/subscriptions');
                    if (response.ok) {
                        const data = await response.json();
                        setSubscriptions(data);
                    }
                } catch (error) {
                    console.error('Error loading subscriptions:', error);
                }
            };

            const refreshEpisodes = async () => {
                try {
                    const response = await fetch('/api/refresh-episodes');
                    const data = await response.json();
                    console.log('Refresh episodes response:', data);
                    
                    if (!response.ok) {
                        console.error('Failed to refresh episodes:', data);
                        return;
                    }
                    
                    setEpisodes(data);
                    // Get latest episode from each subscription
                    const latestFromEach = subscriptions
                        .filter(sub => sub.type === 'podcast')
                        .map(subscription => {
                            // Get all episodes for this subscription
                            const subscriptionEpisodes = Object.values(data.podcast || {})
                                .filter(episode => episode.subscription_id === subscription.id)
                                .sort((a, b) => new Date(b.published) - new Date(a.published));
                            
                            // Return the latest episode if any
                            return subscriptionEpisodes[0];
                        })
                        .filter(Boolean); // Remove any undefined entries
                    
                    setLatestEpisodes(latestFromEach);
                } catch (error) {
                    console.error('Error refreshing episodes:', error);
                }
            };

            const fetchHistory = async () => {
                try {
                    const response = await fetch('/api/history');
                    if (!response.ok) {
                        throw new Error('Failed to fetch history');
                    }
                    const data = await response.json();
                    setHistory(data);
                } catch (error) {
                    console.error('Error fetching history:', error);
                    setError('Failed to load history');
                } finally {
                    setLoading(false);
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!url.trim()) return;

                try {
                    const response = await fetch(`/api/process/episode?url=${encodeURIComponent(url)}`, {
                        method: 'POST'
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to process episode');
                    }

                    // Clear input and refresh history
                    setUrl('');
                    fetchHistory();
                } catch (error) {
                    console.error('Error processing episode:', error);
                    setError('Failed to process episode');
                }
            };

            const handleHistoryItemClick = async (item) => {
                setSelectedHistoryItem(item);
                try {
                    // Fetch both summary and transcript
                    const [summaryResponse, transcriptResponse] = await Promise.all([
                        fetch(`/api/summary/${encodeURIComponent(item.url)}`),
                        fetch(`/api/transcript/${encodeURIComponent(item.url)}`)
                    ]);

                    const summaryData = summaryResponse.ok ? await summaryResponse.json() : null;
                    const transcriptData = transcriptResponse.ok ? await transcriptResponse.json() : null;

                    setSelectedHistoryItem({
                        ...item,
                        summary: summaryData && summaryData.summary ? summaryData.summary : null,
                        transcript: transcriptData && transcriptData.transcript ? transcriptData.transcript : null
                    });
                } catch (error) {
                    console.error('Error fetching data:', error);
                    setError('Failed to load episode data');
                }
            };

            const handleReadOutLoud = async () => {
                if (!selectedHistoryItem || !selectedHistoryItem.id) return;
                
                setIsGeneratingAudio(true);
                try {
                    const response = await fetch(`/api/tts/playlist/${encodeURIComponent(selectedHistoryItem.id)}`);
                    if (!response.ok) {
                        throw new Error('Failed to generate audio');
                    }
                    
                    const data = await response.json();
                    if (data.audio_files && data.audio_files.length > 0) {
                        setAudioFiles(data.audio_files);
                        setCurrentAudioIndex(0);
                        
                        // Start playing the first file
                        if (audioRef.current) {
                            audioRef.current.src = data.audio_files[0].url;
                            audioRef.current.play();
                        }
                    }
                } catch (error) {
                    console.error('Error generating audio:', error);
                    setError('Failed to generate audio');
                } finally {
                    setIsGeneratingAudio(false);
                }
            };

            const handleAudioEnded = () => {
                if (currentAudioIndex < audioFiles.length - 1) {
                    setCurrentAudioIndex(prev => {
                        const nextIndex = prev + 1;
                        if (audioRef.current) {
                            audioRef.current.src = audioFiles[nextIndex].url;
                            audioRef.current.play();
                        }
                        return nextIndex;
                    });
                }
            };

            const handleRefreshMetadata = async (item, e) => {
                e.stopPropagation(); // Prevent triggering the history item click
                
                if (refreshingMetadata[item.id]) return;
                
                setRefreshingMetadata(prev => ({ ...prev, [item.id]: true }));
                try {
                    const response = await fetch(`/api/episode/refresh-metadata/${encodeURIComponent(item.url)}`, {
                        method: 'POST'
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to refresh metadata');
                    }
                    
                    // Refresh history to show updated metadata
                    fetchHistory();
                } catch (error) {
                    console.error('Error refreshing metadata:', error);
                    setError('Failed to refresh metadata');
                } finally {
                    setRefreshingMetadata(prev => ({ ...prev, [item.id]: false }));
                }
            };

            const handlePodcastSearch = async () => {
                if (!searchQuery.trim()) return;
                
                setSearchLoading(true);
                setSearchError(null);
                try {
                    const response = await fetch(`/api/search/podcasts?q=${encodeURIComponent(searchQuery)}`);
                    const data = await response.json();
                    
                    if (!response.ok || data.error) {
                        throw new Error(data.error || 'Failed to search podcasts');
                    }
                    setSearchResults(data);
                } catch (error) {
                    console.error('Error searching podcasts:', error);
                    setSearchError('Failed to search podcasts. Please try again.');
                } finally {
                    setSearchLoading(false);
                }
            };

            const handlePodcastSubscribe = async (podcastId, feedUrl) => {
                try {
                    const podcast = searchResults.find(p => p.id === podcastId);
                    const response = await fetch('/api/subscribe/podcast', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            id: podcastId,
                            feed_url: feedUrl,
                            title: podcast ? podcast.title : ''
                        })
                    });
                    if (response.ok) {
                        alert('Successfully subscribed to podcast!');
                        await refreshEpisodes();
                        await loadSubscriptions();
                    }
                } catch (error) {
                    console.error('Error subscribing to podcast:', error);
                    setError('Failed to subscribe to podcast');
                }
            };

            const handleYoutubeSubscribe = async () => {
                try {
                    const response = await fetch('/api/subscribe/youtube', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({url: youtubeUrl})
                    });
                    if (response.ok) {
                        alert('Successfully subscribed to YouTube channel!');
                        setYoutubeUrl('');
                    }
                } catch (error) {
                    console.error('Error subscribing to YouTube channel:', error);
                    setError('Failed to subscribe to YouTube channel');
                }
            };

            const handleProcessEpisode = async (audioUrl) => {
                try {
                    const response = await fetch(`/api/process/episode?url=${encodeURIComponent(audioUrl)}`, {
                        method: 'POST'
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to process episode');
                    }
                    
                    alert('Episode processing started!');
                    // Refresh history after a short delay to show the new episode
                    setTimeout(fetchHistory, 2000);
                } catch (error) {
                    console.error('Error processing episode:', error);
                    alert('Failed to process episode. Please try again.');
                }
            };

            const renderSummaryContent = (summary) => {
                if (!summary) {
                    return <div className="text-gray-500">No summary available</div>;
                }

                return (
                    <div className="space-y-6">
                        {summary.comprehensive_summary && (
                            <div>
                                <h3 className="text-lg font-medium mb-2">Comprehensive Summary</h3>
                                <p className="text-gray-600 whitespace-pre-wrap">{summary.comprehensive_summary}</p>
                            </div>
                        )}
                        
                        {summary.key_insights && Array.isArray(summary.key_insights) && summary.key_insights.length > 0 && (
                            <div>
                                <h3 className="text-lg font-medium mb-2">Key Insights</h3>
                                <ul className="space-y-2 text-gray-600">
                                    {summary.key_insights.map((point, index) => (
                                        <li key={index}>• {point}</li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        {summary.action_items && Array.isArray(summary.action_items) && summary.action_items.length > 0 && (
                            <div>
                                <h3 className="text-lg font-medium mb-2">Action Items</h3>
                                <ul className="space-y-2 text-gray-600">
                                    {summary.action_items.map((item, index) => (
                                        <li key={index}>• {item}</li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        {summary.wisdom && Array.isArray(summary.wisdom) && summary.wisdom.length > 0 && (
                            <div>
                                <h3 className="text-lg font-medium mb-2">Wisdom & Principles</h3>
                                <ul className="space-y-2 text-gray-600">
                                    {summary.wisdom.map((item, index) => (
                                        <li key={index}>• {item}</li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        {summary.follow_up && Array.isArray(summary.follow_up) && summary.follow_up.length > 0 && (
                            <div>
                                <h3 className="text-lg font-medium mb-2">Follow-up Questions</h3>
                                <ul className="space-y-2 text-gray-600">
                                    {summary.follow_up.map((item, index) => (
                                        <li key={index}>• {item}</li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        {summary.references && Array.isArray(summary.references) && summary.references.length > 0 && (
                            <div>
                                <h3 className="text-lg font-medium mb-2">References & Resources</h3>
                                <ul className="space-y-2 text-gray-600">
                                    {summary.references.map((item, index) => (
                                        <li key={index}>• {item}</li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        {summary.notable_quotes && Array.isArray(summary.notable_quotes) && summary.notable_quotes.length > 0 && (
                            <div>
                                <h3 className="text-lg font-medium mb-2">Notable Quotes</h3>
                                <ul className="space-y-2 text-gray-600">
                                    {summary.notable_quotes.map((quote, index) => (
                                        <li key={index} className="italic">"{quote}"</li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        {summary.topics && Array.isArray(summary.topics) && summary.topics.length > 0 && (
                            <div>
                                <h3 className="text-lg font-medium mb-2">Main Topics</h3>
                                <ul className="space-y-2 text-gray-600">
                                    {summary.topics.map((topic, index) => (
                                        <li key={index}>• {topic}</li>
                                    ))}
                                </ul>
                            </div>
                        )}
                    </div>
                );
            };

            React.useEffect(() => {
                fetchHistory();
                loadSubscriptions();
                refreshEpisodes();
            }, []);

            return (
                <div className="max-w-6xl mx-auto p-6 h-screen overflow-hidden">
                    <div className="flex gap-4 mb-6">
                        <button 
                            className={`px-4 py-2 rounded ${activeView === 'process' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                            onClick={() => setActiveView('process')}
                        >
                            Process Episode
                        </button>
                        <button 
                            className={`px-4 py-2 rounded ${activeView === 'subscribe' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                            onClick={() => setActiveView('subscribe')}
                        >
                            Manage Subscriptions
                        </button>
                    </div>

                    <div className="grid grid-cols-2 gap-8 h-full">
                        {/* Left Column */}
                        <div className="flex flex-col min-h-0">
                            <h1 className="text-2xl font-semibold mb-6 flex-shrink-0">
                                {activeView === 'process' ? 'Podcast summary' : 'Manage Subscriptions'}
                            </h1>
                            
                            {activeView === 'process' ? (
                                <div>
                                    <div className="bg-white p-6 rounded-lg shadow-sm mb-6 flex-shrink-0">
                                        <input
                                            type="text"
                                            placeholder="Paste the episode URL"
                                            value={url}
                                            onChange={(e) => setUrl(e.target.value)}
                                            className="input-field"
                                        />
                                        <button onClick={handleSubmit} className="btn-primary">
                                            Summarize
                                        </button>
                                    </div>
                                    <div className="flex-1 overflow-hidden flex flex-col min-h-0">
                                        <h2 className="text-xl font-semibold mb-4 flex-shrink-0">History</h2>
                                        <div className="space-y-2 overflow-y-auto flex-1">
                                            {loading ? (
                                                <div className="text-gray-500">Loading history...</div>
                                            ) : error ? (
                                                <div className="text-red-500">{error}</div>
                                            ) : history.length === 0 ? (
                                                <div className="text-gray-500">No episodes processed yet</div>
                                            ) : (
                                                history.map(item => (
                                                    <div 
                                                        key={item.id} 
                                                        className={`history-item cursor-pointer hover:bg-gray-50 ${selectedHistoryItem && selectedHistoryItem.id === item.id ? 'bg-gray-50' : ''}`}
                                                        onClick={() => handleHistoryItemClick(item)}
                                                    >
                                                        <div className="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clipRule="evenodd" />
                                                            </svg>
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className="font-medium">{item.title || 'Untitled Episode'}</div>
                                                            <div className="text-sm text-gray-500">
                                                                {new Date(item.processed_at).toLocaleDateString()}
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={(e) => handleRefreshMetadata(item, e)}
                                                            className={`p-2 rounded-full hover:bg-gray-100 ${refreshingMetadata[item.id] ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                            disabled={refreshingMetadata[item.id]}
                                                            title="Refresh metadata"
                                                        >
                                                            <svg xmlns="http://www.w3.org/2000/svg" className={`h-5 w-5 text-gray-500 ${refreshingMetadata[item.id] ? 'animate-spin' : ''}`} viewBox="0 0 20 20" fill="currentColor">
                                                                <path fillRule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clipRule="evenodd" />
                                                            </svg>
                                                        </button>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="subscription-container">
                                    <div className="mb-12">
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-xl font-semibold">Latest Episodes</h3>
                                            <button 
                                                onClick={refreshEpisodes}
                                                className="btn-primary"
                                            >
                                                Refresh Episodes
                                            </button>
                                        </div>
                                        <div className="space-y-4">
                                            {latestEpisodes.length === 0 ? (
                                                <div className="text-gray-500 text-center py-4">No episodes found</div>
                                            ) : (
                                                latestEpisodes.map(episode => (
                                                    <div key={episode.id} className="episode">
                                                        <div className="flex items-center gap-4">
                                                            {episode.image && (
                                                                <img src={episode.image} alt="" className="w-16 h-16 rounded" />
                                                            )}
                                                            <div className="flex-1">
                                                                <h4 className="font-medium text-lg">{episode.title || 'Untitled Episode'}</h4>
                                                                <p className="text-sm text-gray-600">
                                                                    {new Date(episode.published || Date.now()).toLocaleDateString()}
                                                                </p>
                                                            </div>
                                                            <button 
                                                                onClick={() => handleProcessEpisode(episode.audio_url)}
                                                                className="btn-primary whitespace-nowrap"
                                                            >
                                                                Process
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                        <p className="text-sm text-gray-500 mt-4">Showing latest episode from each podcast</p>
                                    </div>

                                    <div className="mb-12">
                                        <h3 className="text-xl font-semibold mb-6">Search Podcasts</h3>
                                        <div className="search-box">
                                            <input
                                                type="text"
                                                placeholder="Search podcasts..."
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                className="input-field flex-1"
                                                onKeyPress={(e) => e.key === 'Enter' && handlePodcastSearch()}
                                                disabled={searchLoading}
                                            />
                                            <button 
                                                onClick={handlePodcastSearch} 
                                                className="btn-primary"
                                                disabled={!searchQuery.trim() || searchLoading}
                                            >
                                                {searchLoading ? 'Searching...' : 'Search'}
                                            </button>
                                        </div>
                                        {searchError && (
                                            <div className="text-red-500 text-sm mt-2">
                                                {searchError}
                                            </div>
                                        )}
                                        <div className="search-results">
                                            {searchResults.length > 0 ? (
                                                <div className="space-y-4">
                                                    {searchResults.map(podcast => (
                                                        <div key={podcast.id} className="flex items-center gap-4 p-4 border rounded hover:bg-gray-50">
                                                            <img src={podcast.artwork} alt={podcast.title} className="w-16 h-16 rounded" />
                                                            <div className="flex-1 min-w-0">
                                                                <h4 className="font-medium text-lg truncate">{podcast.title}</h4>
                                                                <p className="text-sm text-gray-600 truncate">{podcast.author}</p>
                                                                <p className="text-sm text-gray-500 mt-1 line-clamp-2">{podcast.description}</p>
                                                                <div className="mt-2">
                                                                    <a 
                                                                        href={podcast.itunes_url} 
                                                                        target="_blank" 
                                                                        rel="noopener noreferrer"
                                                                        className="text-blue-500 hover:underline text-sm"
                                                                    >
                                                                        View on iTunes
                                                                    </a>
                                                                </div>
                                                            </div>
                                                            <button 
                                                                onClick={() => handlePodcastSubscribe(podcast.id, podcast.feed_url)}
                                                                className="btn-primary whitespace-nowrap"
                                                            >
                                                                Subscribe
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : searchQuery ? (
                                                <div className="text-gray-500 text-center py-8">
                                                    No podcasts found. Try a different search term.
                                                </div>
                                            ) : null}
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h3 className="text-xl font-semibold mb-6">Add YouTube Channel</h3>
                                        <div className="search-box">
                                            <input
                                                type="text"
                                                placeholder="Enter YouTube channel URL"
                                                value={youtubeUrl}
                                                onChange={(e) => setYoutubeUrl(e.target.value)}
                                                className="input-field flex-1"
                                                onKeyPress={(e) => e.key === 'Enter' && handleYoutubeSubscribe()}
                                            />
                                            <button 
                                                onClick={handleYoutubeSubscribe} 
                                                className="btn-primary"
                                                disabled={!youtubeUrl.trim()}
                                            >
                                                Subscribe
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Right Column */}
                        <div className="bg-white rounded-lg shadow-sm flex flex-col min-h-0">
                            <div className="flex gap-8 p-6 border-b flex-shrink-0">
                                <button 
                                    className={`pb-2 ${activeTab === 'original' ? 'tab-active' : ''}`}
                                    onClick={() => setActiveTab('original')}
                                >
                                    Original Content
                                </button>
                                <button 
                                    className={`pb-2 ${activeTab === 'summary' ? 'tab-active' : ''}`}
                                    onClick={() => setActiveTab('summary')}
                                >
                                    Summary
                                </button>
                            </div>

                            <div className="flex-1 overflow-hidden">
                                {selectedHistoryItem ? (
                                    <div className="h-full flex flex-col min-h-0">
                                        <div className="p-6 flex-shrink-0">
                                            <h2 className="text-xl font-semibold mb-4">
                                                {activeTab === 'original' ? 'Original Content' : 'Episode Summary'}
                                            </h2>
                                            
                                            {activeTab === 'summary' && (
                                                <div>
                                                    <button 
                                                        onClick={handleReadOutLoud}
                                                        disabled={isGeneratingAudio}
                                                        className={`btn-primary flex items-center justify-center gap-2 mb-6 ${isGeneratingAudio ? 'opacity-75 cursor-not-allowed' : ''}`}
                                                    >
                                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                            <path fillRule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414z" clipRule="evenodd" />
                                                        </svg>
                                                        {isGeneratingAudio ? 'Generating audio...' : 'Read out loud'}
                                                    </button>
                                                    
                                                    {audioFiles.length > 0 && (
                                                        <div className="mb-6">
                                                            <audio 
                                                                ref={audioRef}
                                                                className="w-full" 
                                                                controls
                                                                onEnded={handleAudioEnded}
                                                            >
                                                                Your browser does not support the audio element.
                                                            </audio>
                                                            <div className="text-sm text-gray-500 mt-1">
                                                                Playing section {currentAudioIndex + 1} of {audioFiles.length}
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </div>

                                        <div className="flex-1 overflow-y-auto px-6 pb-6">
                                            {activeTab === 'original' ? (
                                                selectedHistoryItem.transcript ? (
                                                    <div className="text-gray-600 whitespace-pre-wrap font-mono text-sm">
                                                        {selectedHistoryItem.transcript}
                                                    </div>
                                                ) : (
                                                    <div className="text-gray-500">Loading transcript...</div>
                                                )
                                            ) : (
                                                selectedHistoryItem.summary ? (
                                                    renderSummaryContent(selectedHistoryItem.summary)
                                                ) : (
                                                    <div className="text-gray-500">Loading summary...</div>
                                                )
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex items-center justify-center h-full text-gray-500 p-6">
                                        Select a podcast from history to view its content
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    {/* Hidden audio element for TTS playback */}
                    <audio 
                        ref={audioRef}
                        className="hidden"
                        onEnded={handleAudioEnded}
                    >
                        Your browser does not support the audio element.
                    </audio>
                </div>
            );
        }

        function App() {
            return (
                <div className="min-h-screen">
                    <main>
                        <Dashboard />
                    </main>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html> 